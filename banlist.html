<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoL Tournament Ban List Viewer</title>
    <style>
        :root {
            --banned-color: #B33A3A; /* Deep Red */
            --available-color: #3AB37D; /* Teal/Green */
            --background-color: #1a1a2e; /* Dark Blue/Purple */
            --card-bg: #2c2c54;
            --text-color: #ffffff;
            --header-bg: #162447;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: var(--available-color);
            border-bottom: 2px solid var(--header-bg);
            padding-bottom: 10px;
            margin-bottom: 30px;
        }

        /* Top Bar for Refresh Info and Controls */
        .top-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 20px;
        }
        
        #refresh-status {
            font-size: 0.9em;
            color: #ccc;
        }

        .controls {
            display: flex;
            gap: 20px;
            padding: 15px;
            background-color: var(--header-bg);
            border-radius: 8px;
            flex-wrap: wrap; /* Allows controls to wrap on smaller screens */
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .controls label {
            font-size: 1.1em;
        }

        #filter-select, #text-filter {
            padding: 10px 15px;
            border-radius: 5px;
            border: 1px solid var(--available-color);
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 1em;
            cursor: pointer;
            min-width: 150px;
        }

        /* Champion List Grid */
        #champion-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }

        .champion-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s;
        }

        .champion-card:hover {
            transform: translateY(-5px);
        }

        .champion-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .champion-status {
            font-size: 0.9em;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            color: var(--text-color);
            display: inline-block;
        }

        /* Status Coloring */
        .status-Banned {
            background-color: var(--banned-color);
        }

        .status-Available {
            background-color: var(--available-color);
        }

        .loading-message {
            text-align: center;
            font-size: 1.5em;
            padding: 50px;
            grid-column: 1 / -1; /* Centers the message in the grid */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§° Swain Charity Tournament Ban Status ü§°</h1>
        
        <div class="top-info">
            <div id="refresh-status"></div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="filter-select">Filter Status:</label>
                <select id="filter-select">
                    <option value="All">All Champions</option>
                    <option value="Available">Available</option>
                    <option value="Banned">Banned</option>
                    <option value="BanOrder">Banned Order</option>
                </select>
            </div>
            <div class="control-group">
                <label for="text-filter">Search Name:</label>
                <input type="text" id="text-filter" placeholder="Type Champion Name...">
            </div>
        </div>

        <div id="champion-list" class="loading-message">
            Loading Champion Data...
        </div>
    </div>

    <script>
        const SPREADSHEET_ID = 'e/2PACX-1vQJ8422w9uVjUOHlrr0AZAHD0eNts8REfeL42SiKuw2Qwkjgv75_8gSh4WSprY_GpEGHInJqDdiDtP2'; 
        // 0 is typically the first sheet (BanData), but check your URL
        const SHEET_GID = '688926347'; 

        // This URL fetches the data from your published sheet in a plain CSV format.
        const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQJ8422w9uVjUOHlrr0AZAHD0eNts8REfeL42SiKuw2Qwkjgv75_8gSh4WSprY_GpEGHInJqDdiDtP2/pub?gid=688926347&single=true&output=csv';// `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&gid=${SHEET_GID}`;

        const REFRESH_INTERVAL_MS = 5 * 60 * 1000; // 5 minutes in milliseconds

        const championListElement = document.getElementById('champion-list');
        const filterSelect = document.getElementById('filter-select');
        const textFilter = document.getElementById('text-filter');
        const refreshStatusElement = document.getElementById('refresh-status');
        let championData = []; // To store the parsed data
        let banOrderData = [];

        // --- Data Fetching and Parsing ---

        async function fetchData() {
            try {
                const response = await fetch(GOOGLE_SHEET_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvText = await response.text();
                
                // Update last refresh time after successful fetch (not after the reload)
                const now = new Date();
                const timeString = now.toLocaleTimeString();
                refreshStatusElement.innerHTML = `Last Updated: **${timeString}** (Auto-reloads in 5 min)`;

                championData = parseData(csvText);
                banOrderData = parseBanOrder(csvText);
                applyFilters();
            } catch (error) {
                championListElement.innerHTML = `<div class="loading-message" style="color: red;">
                    ‚ùå Error loading data. Please check your **SPREADSHEET_ID** and ensure the Google Sheet is published to the web.
                </div>`;
                console.error("Fetch error:", error);
            }
        }

        function parseData(csvText) {
            const rows = csvText.split('\n').slice(1); 
            const parsedData = rows.map(row => {
                const columns = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                
                const name = columns[0] ? columns[0].replace(/"/g, '').trim() : '';
                const status = columns[2] ? columns[2].replace(/"/g, '').trim() : '';

                if (name && status) {
                    return { name, status };
                }
                return null;
            }).filter(item => item !== null);

            return parsedData.sort((a, b) => a.name.localeCompare(b.name));
        }
        
      	function parseBanOrder(csvText) {
        	const rows = csvText.split('\n').slice(1); 
        	const parsedData = rows.map(row => {
                const columns = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                
                const name = columns[8] ? columns[8].replace(/"/g, '').trim() : '';
                const status = "Banned";
                if (name) {
                    return { name, status };
                }
                return null;
            }).filter(item => item !== null);
            
            return parsedData;
        }

        // --- Filtering and Rendering ---
        function applyFilters() {
            const statusFilter = filterSelect.value;
            const nameFilter = textFilter.value.toLowerCase().trim();
            if(statusFilter === "BanOrder")
            {
            	renderList(banOrderData);
            	return;
            }
            const filteredData = championData.filter(champion => {
                // 1. Status Filter
                const statusMatch = (statusFilter === 'All' || champion.status === statusFilter);
                
                // 2. Text (Name) Filter
                const nameMatch = champion.name.toLowerCase().includes(nameFilter);

                return statusMatch && nameMatch;
            });

            renderList(filteredData);
        }

        function renderList(data) {
            championListElement.innerHTML = '';
            
            if (data.length === 0) {
                championListElement.innerHTML = `<div class="loading-message">No champions match the current filters.</div>`;
                return;
            }

            championListElement.style.display = 'grid';

            data.forEach(champion => {
                const card = document.createElement('div');
                card.classList.add('champion-card');
                
                var imageURL = `https://ddragon.leagueoflegends.com/cdn/15.21.1/img/champion/${champion.name.replace(/[^A-Za-z0-9]/g, '')}.png`;
                const borderColor = champion.status === 'Banned' ? 'red' : 'green';                
				if(champion.name.toLowerCase() == "wukong")
                {
                	imageURL = `https://ddragon.leagueoflegends.com/cdn/15.21.1/img/champion/MonkeyKing.png`;
                }
				
                card.innerHTML = `
                    <div class="champion-name">${champion.name}</div>
                    <img src="${imageURL}" 
                         alt="${champion.name} Icon" 
                         onerror="this.onerror=null;this.style.display='none';"
                         style="width: 80px; height: 80px; border-radius: 50%; margin: 10px 0; border: 3px solid ${borderColor};">
                    <div class="champion-status status-${champion.status}">${champion.status}</div>
                `;
                championListElement.appendChild(card);
            });
        }

        filterSelect.addEventListener('change', applyFilters);
        textFilter.addEventListener('input', applyFilters);

        // Auto-refresh logic (fetches data, doesn't reload the entire page)
        setInterval(fetchData, REFRESH_INTERVAL_MS);
        fetchData();
    </script>
</body>
</html>


